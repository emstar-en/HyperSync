{
  "$id": "https://hypersync.ai/schemas/security/security_policy.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "User or model-defined security policy with nLD threat protection",
  "properties": {
    "authentication": {
      "description": "Optional authentication settings",
      "properties": {
        "credentials": {
          "description": "Encrypted credential storage",
          "type": "object"
        },
        "enabled": {
          "default": false,
          "type": "boolean"
        },
        "method": {
          "default": "none",
          "enum": [
            "password",
            "key",
            "certificate",
            "none"
          ]
        }
      },
      "type": "object"
    },
    "hierarchy": {
      "description": "Node hierarchy configuration",
      "properties": {
        "child_nodes": {
          "description": "Child nodes in hierarchy",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "inherit_policies": {
          "default": true,
          "description": "Inherit policies from parent nodes",
          "type": "boolean"
        },
        "parent_nodes": {
          "description": "Parent nodes in hierarchy",
          "items": {
            "type": "string"
          },
          "type": "array"
        }
      },
      "type": "object"
    },
    "metadata": {
      "properties": {
        "created_at": {
          "format": "date-time",
          "type": "string"
        },
        "updated_at": {
          "format": "date-time",
          "type": "string"
        }
      },
      "type": "object"
    },
    "nld_protection": {
      "description": "nLD threat protection settings",
      "properties": {
        "audit_medium_threats": {
          "default": true,
          "description": "Log medium-level threats (nLD 4-6)",
          "type": "boolean"
        },
        "auto_block_critical": {
          "default": true,
          "description": "Automatically block nLD > 10",
          "type": "boolean"
        },
        "enabled": {
          "default": true,
          "description": "Enable nLD threat detection",
          "type": "boolean"
        },
        "max_nld_score": {
          "default": 6,
          "description": "Maximum allowed nLD score (number of LDs)",
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "enabled",
        "max_nld_score"
      ],
      "type": "object"
    },
    "owner": {
      "description": "Policy owner (user or model)",
      "properties": {
        "id": {
          "type": "string"
        },
        "priority": {
          "description": "Priority level (higher = more authority)",
          "maximum": 100,
          "minimum": 0,
          "type": "integer"
        },
        "type": {
          "enum": [
            "user",
            "model",
            "system"
          ]
        }
      },
      "required": [
        "type",
        "id"
      ],
      "type": "object"
    },
    "policy_id": {
      "description": "Unique policy identifier",
      "type": "string"
    },
    "rules": {
      "description": "Policy rules to enforce",
      "items": {
        "properties": {
          "action": {
            "description": "Action pattern to match (glob-style)",
            "type": "string"
          },
          "conditions": {
            "description": "Additional conditions for rule activation",
            "type": "object"
          },
          "effect": {
            "enum": [
              "allow",
              "deny",
              "audit"
            ]
          },
          "rule_id": {
            "type": "string"
          }
        },
        "required": [
          "rule_id",
          "action",
          "effect"
        ],
        "type": "object"
      },
      "type": "array"
    }
  },
  "required": [
    "policy_id",
    "owner",
    "rules",
    "nld_protection"
  ],
  "title": "SecurityPolicy",
  "type": "object"
}