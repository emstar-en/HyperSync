{
  "$schema": "ext://f1fed686329b",
  "native_terminal_emulator_support": {
    "accessibility": {
      "high_contrast": {
        "bold": "use bold for emphasis",
        "theme": "black/white only"
      },
      "reduced_motion": {
        "disable_animations": true,
        "instant_updates": "no fade/slide"
      },
      "screen_reader_support": {
        "announcements": "write to stderr for screen reader",
        "semantic_markup": "use status lines for context",
        "text_mode": "plain text output for screen readers"
      }
    },
    "ansi_escape_sequence_engine": {
      "cursor_control": {
        "movement": {
          "CHA": "cursor horizontal absolute",
          "CUB": "cursor back",
          "CUD": "cursor down",
          "CUF": "cursor forward",
          "CUP": "cursor position",
          "CUU": "cursor up",
          "HVP": "horizontal vertical position",
          "VPA": "vertical position absolute"
        },
        "save_restore": {
          "restore": "CSI u or ESC 8",
          "save": "CSI s or ESC 7"
        },
        "visibility": {
          "hide": "CSI ? 25 l",
          "show": "CSI ? 25 h"
        }
      },
      "parser": {
        "buffer_size": 4096,
        "modes": [
          "CSI",
          "OSC",
          "DCS",
          "APC",
          "PM"
        ],
        "state_machine": "ANSI X3.64 / ECMA-48"
      },
      "screen_control": {
        "alternate_screen": {
          "enter": "CSI ? 1049 h",
          "exit": "CSI ? 1049 l"
        },
        "clear": {
          "line": "CSI 2 K",
          "screen": "CSI 2 J",
          "to_end": "CSI 0 J",
          "to_start": "CSI 1 J"
        },
        "scroll": {
          "down": "CSI T",
          "region": "CSI r",
          "up": "CSI S"
        }
      },
      "sgr_attributes": {
        "background_256": "48;5;n",
        "background_8": "40-47",
        "background_rgb": "48;2;r;g;b",
        "foreground_256": "38;5;n",
        "foreground_8": "30-37",
        "foreground_rgb": "38;2;r;g;b",
        "text_style": {
          "0": "reset",
          "1": "bold",
          "2": "dim",
          "3": "italic",
          "4": "underline",
          "5": "blink_slow",
          "6": "blink_fast",
          "7": "reverse",
          "8": "conceal",
          "9": "strikethrough"
        }
      }
    },
    "api_contract": {
      "cleanup": {
        "actions": [
          "restore terminal state",
          "exit alternate screen",
          "show cursor",
          "reset colors"
        ],
        "method": "hypersync_tui_shutdown"
      },
      "event_handling": {
        "method": "hypersync_tui_poll_event",
        "returns": {
          "data": "event-specific data",
          "event_type": "key|mouse|resize|signal"
        }
      },
      "initialization": {
        "method": "hypersync_tui_init",
        "params": {
          "color_mode": "auto-detect or force",
          "graphics_mode": "auto-detect or disable",
          "locale": "from env or override",
          "terminal_type": "auto-detect or override"
        },
        "returns": {
          "capabilities": "detected terminal features",
          "tui_context": "opaque handle"
        }
      },
      "rendering": {
        "method": "hypersync_tui_render",
        "params": {
          "components": "list of components to render",
          "context": "tui_context",
          "force_redraw": "boolean"
        }
      }
    },
    "audio_integration": {
      "audio_cue_mapping": {
        "error": "visual + audio + optional beep",
        "navigation": "audio only (no visual change)",
        "state_change": "visual + audio",
        "success": "visual + audio"
      },
      "coordinate_with_terminal_audio": {
        "beep_fallback": "use when no audio system available",
        "rich_audio": "use HyperSync UI audio when available",
        "sync_visual_audio": "coordinate TUI updates with audio cues"
      }
    },
    "documentation": {
      "api_reference": "hypersync_tui_api_reference.md",
      "terminal_compatibility": "hypersync_terminal_compatibility_matrix.md",
      "troubleshooting": "hypersync_tui_troubleshooting.md",
      "user_guide": "hypersync_tui_user_guide.md"
    },
    "graphics_protocol_support": {
      "fallback_strategy": {
        "capability_query": {
          "cache": true,
          "timeout_ms": 100
        },
        "detection_order": [
          "kitty_graphics",
          "iterm2_inline",
          "sixel",
          "ascii_art",
          "unicode_blocks"
        ]
      },
      "iterm2_inline": {
        "args": {
          "height": "cells or pixels",
          "inline": "0 or 1",
          "name": "filename",
          "preserveAspectRatio": "0 or 1",
          "size": "bytes",
          "width": "cells or pixels"
        },
        "format": "OSC 1337 ; File=[args]:base64data BEL"
      },
      "kitty_graphics": {
        "actions": {
          "delete": "t=d,d=...",
          "display": "t=d",
          "query": "t=q",
          "transmit": "t=t",
          "transmit_and_display": "t=T"
        },
        "composition": {
          "alpha": "transparency support",
          "blend": "composition modes"
        },
        "placement": {
          "columns": "specify width in cells",
          "pixels": "exact pixel dimensions",
          "rows": "specify height in cells",
          "z_index": "layering"
        },
        "transmission": {
          "chunked": "split large images",
          "direct": "base64 in single chunk",
          "file": "reference file path",
          "temp_file": "write to temp, reference"
        }
      },
      "sixel": {
        "aspect_ratio": "configurable",
        "color_registers": 256,
        "compression": "RLE",
        "encoder": {
          "dithering": [
            "none",
            "atkinson",
            "floyd_steinberg"
          ],
          "library": "libsixel",
          "quality_levels": [
            "low",
            "medium",
            "high"
          ]
        },
        "sequence": "DCS Pn ; Pn ; Pn q ... ST",
        "spec": "DEC VT340",
        "use_cases": [
          "charts",
          "graphs",
          "icons",
          "logos",
          "image_preview",
          "qr_codes"
        ]
      }
    },
    "hypersync_tui_components": {
      "command_palette": {
        "audio_cues": {
          "execute": "category.action_confirm",
          "open": "category.modal_open"
        },
        "commands": [
          "sync:start",
          "sync:stop",
          "node:add",
          "node:remove",
          "consensus:force",
          "theme:switch",
          "audio:toggle"
        ],
        "fuzzy_search": true,
        "trigger": "Ctrl+P or Ctrl+K"
      },
      "consensus_visualizer": {
        "audio_sync": "pulse on consensus reached",
        "rendering": {
          "ascii_fallback": "tree_view",
          "fallback": "unicode_blocks",
          "graphics_mode": "sixel or kitty if available"
        },
        "type": "hyperbolic_disk",
        "update_rate_hz": 10
      },
      "log_viewer": {
        "audio_cues": {
          "error": "category.error_critical",
          "warning": "category.warning_soft"
        },
        "features": {
          "filter": "by level/category",
          "follow": "tail -f mode",
          "search": "regex support",
          "syntax_highlight": "ANSI colors"
        },
        "widget": "scrollable_text"
      },
      "node_list": {
        "item_format": "[{status_icon}] {node_id} - {distance}",
        "selection": {
          "audio_cue": "category.navigation",
          "highlight": "theme.selection"
        },
        "update_animation": {
          "duration_ms": 200,
          "type": "fade"
        },
        "widget": "scrollable_list"
      },
      "status_bar": {
        "audio_cues": {
          "on_status_change": "category.state_change"
        },
        "layout": "single line, bottom or top",
        "segments": [
          {
            "color": "theme.status.{syncing|success|error}",
            "content": "\u27f3 Syncing | \u2713 Synced | \u2717 Error",
            "id": "sync_status"
          },
          {
            "color": "theme.info",
            "content": "Consensus: {state}",
            "id": "consensus_state"
          },
          {
            "color": "theme.secondary",
            "content": "Nodes: {count}",
            "id": "node_count"
          }
        ]
      }
    },
    "metadata": {
      "date": "2025-12-03",
      "integrates_with": [
        "hypersync_ui_audio_low_bit_and_terminal_fallbacks.json",
        "hypersync_ux_customization_accessibility_i18n.json",
        "hypersync_multilingual_support_spec.expanded.json",
        "hypersync_ux_themes_kits_and_format_routing.json"
      ],
      "purpose": "Native terminal emulator support for xterm, mlterm, and modern terminal protocols",
      "scope": "TUI rendering, ANSI sequences, graphics protocols, multilingual terminal support"
    },
    "multilingual_terminal_support": {
      "locale_integration": {
        "date_time": {
          "calendar": "Gregorian default, others supported",
          "format": "locale-specific"
        },
        "detection": {
          "env_vars": [
            "LANG",
            "LC_ALL",
            "LC_CTYPE"
          ],
          "fallback": "en_US.UTF-8"
        },
        "number_formats": {
          "decimal": "locale-specific",
          "grouping": "locale-specific"
        },
        "text_direction": {
          "ltr": [
            "en",
            "es",
            "fr",
            "de",
            "ja",
            "zh",
            "ko"
          ],
          "rtl": [
            "ar",
            "he",
            "fa",
            "ur"
          ]
        }
      },
      "mlterm_integration": {
        "bidi_rendering": {
          "algorithm": "Unicode Bidirectional Algorithm (UAX #9)",
          "auto_detect": "from locale or content",
          "override": "LRO/RLO/PDF control chars"
        },
        "complex_script_shaping": {
          "arabic": {
            "diacritics": "combining marks",
            "joining": "initial/medial/final/isolated forms",
            "ligatures": true
          },
          "indic": {
            "conjuncts": true,
            "reordering": "pre/post base",
            "vowel_signs": "combining marks"
          },
          "thai": {
            "tone_marks": "combining marks",
            "word_break": "dictionary-based"
          }
        },
        "font_fallback": {
          "config": "~/.mlterm/font",
          "per_script": {
            "arabic": "Noto Sans Arabic",
            "cjk": "Noto Sans CJK",
            "devanagari": "Noto Sans Devanagari",
            "hebrew": "Noto Sans Hebrew",
            "thai": "Noto Sans Thai"
          }
        },
        "input_method_integration": {
          "compose_key": "multi-key sequences",
          "ibus": "Intelligent Input Bus",
          "xim": "X Input Method"
        }
      },
      "unicode_rendering": {
        "combining_characters": {
          "rendering": "proper positioning",
          "stacking": "multiple combining marks"
        },
        "emoji": {
          "rendering": {
            "color": "if terminal supports",
            "fallback": "text presentation"
          },
          "support": "Unicode 15.0+",
          "width": "double-width for most emoji"
        },
        "normalization": {
          "form": "NFC (composed) for display",
          "storage": "NFD (decomposed) for processing"
        },
        "zero_width": {
          "zwj": "zero-width joiner for ligatures",
          "zwnj": "zero-width non-joiner"
        }
      }
    },
    "performance_optimization": {
      "buffering": {
        "flush_strategy": {
          "event_based": "on user input",
          "size_based": "every 4KB",
          "time_based": "every 16ms (60fps)"
        },
        "output_buffer": "accumulate before write"
      },
      "escape_sequence_optimization": {
        "cache_sequences": "pre-compute common sequences",
        "combine_sgr": "CSI 1;31;42m instead of three sequences",
        "relative_cursor": "use CUF/CUB instead of absolute CUP"
      },
      "rendering": {
        "cursor_optimization": "minimize cursor movements",
        "dirty_tracking": "only redraw changed regions",
        "double_buffering": "prevent flicker"
      }
    },
    "terminal_emulator_support": {
      "iterm2": {
        "capabilities": {
          "badges": true,
          "inline_images": {
            "base64": true,
            "formats": [
              "PNG",
              "JPEG",
              "GIF",
              "TIFF"
            ],
            "protocol": "iTerm2 inline images"
          },
          "shell_integration": true
        },
        "detection": {
          "env_vars": [
            "TERM_PROGRAM=iTerm.app"
          ]
        }
      },
      "kitty": {
        "capabilities": {
          "graphics": {
            "features": [
              "transparency",
              "composition",
              "animation",
              "placeholders"
            ],
            "formats": [
              "PNG",
              "JPEG",
              "RGB/RGBA raw"
            ],
            "protocol": "Kitty graphics protocol"
          },
          "keyboard": {
            "disambiguate": "all key combinations",
            "protocol": "Kitty keyboard protocol"
          },
          "unicode": {
            "emoji": "full color",
            "ligatures": true,
            "variation_selectors": true
          }
        },
        "detection": {
          "query": "CSI ? u (keyboard protocol query)"
        }
      },
      "mlterm": {
        "capabilities": {
          "colors": {
            "256_color": true,
            "true_color": true
          },
          "fonts": {
            "fallback_chain": true,
            "per_script": "different fonts per Unicode block",
            "variable_width": true
          },
          "graphics": {
            "inline_images": "mlterm native protocol",
            "sixel": true
          },
          "input_methods": {
            "fcitx": true,
            "ibus": true,
            "uim": true,
            "xim": true
          },
          "multilingual": {
            "bidi": "full RTL/LTR support",
            "combining_chars": "full Unicode normalization",
            "complex_scripts": [
              "Arabic",
              "Hebrew",
              "Indic",
              "Thai",
              "Khmer"
            ],
            "vertical_text": "CJK vertical writing modes"
          }
        },
        "detection": {
          "env_vars": [
            "TERM=mlterm*",
            "MLTERM_VERSION"
          ],
          "query": "OSC 5379 (mlterm-specific)"
        }
      },
      "wezterm": {
        "capabilities": {
          "graphics": [
            "sixel",
            "kitty",
            "iterm2"
          ],
          "ligatures": true,
          "true_color": true
        }
      },
      "xterm": {
        "capabilities": {
          "colors": {
            "16_color": "ANSI extended",
            "256_color": "xterm-256color",
            "8_color": "ANSI basic",
            "true_color": "24-bit RGB via SGR"
          },
          "cursor_control": {
            "positioning": "CSI sequences",
            "shape": "DECSCUSR (block/underline/bar)",
            "visibility": "DECTCEM"
          },
          "graphics": {
            "note": "Most xterm builds lack sixel by default",
            "sixel": "optional (compile flag)"
          },
          "mouse_support": {
            "events": [
              "click",
              "drag",
              "scroll",
              "motion"
            ],
            "protocols": [
              "X10",
              "X11",
              "SGR",
              "URXVT"
            ]
          },
          "scrolling": {
            "regions": "DECSTBM",
            "smooth_scroll": true
          },
          "text_attributes": [
            "bold",
            "dim",
            "italic",
            "underline",
            "blink",
            "reverse",
            "strikethrough"
          ]
        },
        "detection": {
          "env_vars": [
            "TERM=xterm*",
            "XTERM_VERSION"
          ],
          "query": "CSI > q (XTVERSION)"
        }
      }
    },
    "testing_and_validation": {
      "terminal_emulator_matrix": [
        "xterm 370+",
        "mlterm 3.9+",
        "kitty 0.26+",
        "iTerm2 3.0+",
        "WezTerm 20220101+",
        "Alacritty 0.12+",
        "Windows Terminal 1.15+",
        "GNOME Terminal 3.44+",
        "Konsole 22.12+"
      ],
      "test_scenarios": [
        {
          "name": "basic_rendering",
          "tests": [
            "colors",
            "text_attributes",
            "cursor_movement",
            "screen_clear"
          ]
        },
        {
          "name": "graphics",
          "tests": [
            "sixel_display",
            "kitty_protocol",
            "iterm2_inline",
            "fallback"
          ]
        },
        {
          "name": "multilingual",
          "tests": [
            "bidi",
            "complex_scripts",
            "emoji",
            "combining_chars"
          ]
        },
        {
          "name": "interaction",
          "tests": [
            "keyboard",
            "mouse",
            "resize",
            "paste"
          ]
        },
        {
          "name": "performance",
          "tests": [
            "large_output",
            "rapid_updates",
            "memory_usage"
          ]
        }
      ],
      "validation_tools": {
        "esctest": "escape sequence validation",
        "unicode_test": "Unicode rendering validation",
        "vttest": "comprehensive terminal testing"
      }
    },
    "theme_integration": {
      "dynamic_theme_switching": {
        "audio_cue": "category.theme_switch",
        "transition": {
          "method": "redraw with new colors",
          "preserve_state": "cursor, scroll position"
        },
        "trigger": "user command or system event"
      },
      "terminal_themes": {
        "color_mapping": {
          "capability_detection": {
            "detect_truecolor": "COLORTERM=truecolor",
            "query_colors": "OSC 4 ; c ; ? BEL"
          },
          "from_design_tokens": {
            "background": "default or RGB",
            "error": "ANSI red",
            "foreground": "default or RGB",
            "primary": "ANSI bright blue or RGB",
            "secondary": "ANSI cyan or RGB",
            "success": "ANSI green",
            "warning": "ANSI yellow"
          }
        },
        "fallback_chain": {
          "16_color": "basic quality",
          "24bit_rgb": "best quality",
          "256_color": "good quality",
          "8_color": "minimal"
        }
      }
    },
    "tui_framework_integration": {
      "blessed": {
        "features": {
          "mouse": "full support",
          "unicode": "full support",
          "widgets": "comprehensive set"
        },
        "hypersync_bindings": {
          "nodejs_integration": "HyperSync Node.js SDK"
        },
        "language": "Node.js"
      },
      "ncurses": {
        "features": {
          "colors": "init_pair, COLOR_PAIR",
          "input": "getch, get_wch (wide char)",
          "mouse": "mousemask, getmouse",
          "panels": "overlapping windows",
          "windows": "WINDOW management"
        },
        "hypersync_bindings": {
          "audio_cues": "trigger on window events",
          "i18n": "wide char support for all text",
          "theme_mapping": "color pairs from theme tokens"
        }
      },
      "notcurses": {
        "features": {
          "animations": "sprite support",
          "direct_mode": "no terminfo required",
          "multimedia": "images, video, audio",
          "transparency": "alpha channel",
          "unicode": "full plane 0-2"
        },
        "hypersync_bindings": {
          "audio_sync": "coordinate with UI audio",
          "graphics": "use for rich visualizations",
          "performance": "GPU acceleration where available"
        }
      },
      "ratatui": {
        "features": {
          "events": "crossterm/termion backend",
          "layouts": "flexbox-like",
          "widgets": [
            "block",
            "list",
            "table",
            "chart",
            "gauge"
          ]
        },
        "hypersync_bindings": {
          "async": "tokio integration",
          "rust_integration": "native Rust HyperSync bindings"
        },
        "language": "Rust"
      }
    }
  },
  "properties": {
    "device_digest": {
      "type": [
        "string",
        "null"
      ]
    },
    "dicom_digest": {
      "type": [
        "string",
        "null"
      ]
    },
    "modality": {
      "type": "string"
    },
    "protocol": {
      "type": [
        "string",
        "null"
      ]
    },
    "receipt_kind": {
      "const": "ClinicalTransformReceipt"
    },
    "resampling": {
      "type": [
        "object",
        "null"
      ]
    }
  },
  "required": [
    "receipt_kind",
    "modality"
  ],
  "title": "ClinicalTransformReceipt",
  "type": "object"
}