{
  "meta": {
    "id": "spec.ops.deployment_docs",
    "version": "1.2.2",
    "type": "generation_policy",
    "description": "Defines the policy for generating deployment documentation from machine-optimized artifacts, with tier-specific availability.",
    "status": "ALPHA"
  },
  "policy": {
    "source_of_truth": "artifact://stunir/machine_optimized",
    "enforcement": "strict",
    "targets": [
      {
        "environment": "aws",
        "language": "terraform",
        "output_format": "markdown",
        "template_ref": "ops/templates/aws_tf_deploy.md.j2",
        "supported_tiers": [
          "basic",
          "pro",
          "advanced",
          "quartermaster"
        ],
        "required_artifacts": [
          "main.tf.json",
          "variables.tf.json"
        ]
      },
      {
        "environment": "kubernetes",
        "language": "helm",
        "output_format": "markdown",
        "template_ref": "ops/templates/k8s_helm_deploy.md.j2",
        "supported_tiers": [
          "pro",
          "advanced",
          "quartermaster"
        ],
        "required_artifacts": [
          "Chart.yaml",
          "values.yaml"
        ]
      },
      {
        "environment": "bare_metal",
        "language": "ansible",
        "output_format": "markdown",
        "template_ref": "ops/templates/metal_ansible_deploy.md.j2",
        "supported_tiers": [
          "core",
          "basic",
          "pro",
          "advanced",
          "quartermaster"
        ],
        "required_artifacts": [
          "playbook.yml",
          "inventory.ini"
        ]
      },
      {
        "environment": "desktop",
        "language": "docker_compose",
        "output_format": "markdown",
        "template_ref": "ops/templates/desktop_docker_compose.md.j2",
        "supported_tiers": [
          "core",
          "basic",
          "pro",
          "advanced",
          "quartermaster"
        ],
        "required_artifacts": [
          "docker-compose.yml",
          ".env.example"
        ]
      },
      {
        "environment": "generic_network",
        "language": "cloud_init",
        "output_format": "markdown",
        "template_ref": "ops/templates/generic_cloud_init.md.j2",
        "supported_tiers": [
          "core",
          "basic",
          "pro",
          "advanced",
          "quartermaster"
        ],
        "required_artifacts": [
          "user-data",
          "meta-data"
        ]
      },
      {
        "environment": "edge",
        "language": "systemd",
        "output_format": "markdown",
        "template_ref": "ops/templates/edge_device_deploy.md.j2",
        "supported_tiers": [
          "advanced",
          "quartermaster"
        ],
        "required_artifacts": [
          "service.unit",
          "config.toml"
        ]
      },
      {
        "environment": "enterprise_airgap",
        "language": "bash",
        "output_format": "markdown",
        "template_ref": "ops/templates/enterprise_airgap_guide.md.j2",
        "supported_tiers": [
          "advanced",
          "quartermaster"
        ],
        "required_artifacts": [
          "image_tarballs",
          "checksums.txt",
          "install.sh"
        ]
      },
      {
        "environment": "iam_bootstrap",
        "language": "yaml",
        "output_format": "yaml",
        "template_ref": "ops/templates/iam_bootstrap.spec.j2",
        "supported_tiers": [
          "core",
          "basic",
          "pro",
          "advanced",
          "quartermaster"
        ],
        "required_artifacts": [
          "hardware_profile.json",
          "iam_policy.json"
        ]
      }
    ],
    "custom_templates": {
      "allowed": true,
      "location": "ops/templates/custom/",
      "guidelines": "Must consume standard STUNIR JSON artifacts."
    },
    "validation": {
      "rules": [
        "ensure_parameter_parity",
        "verify_version_alignment",
        "check_security_context_propagation"
      ]
    }
  },
  "mathematical_foundations": {
    "template_rendering_theory": {
      "formalism": "Function T: (Template, Context) -> Artifact",
      "invariants": [
        "Completeness: All variables in Template must be present in Context",
        "Determinism: T(t, c) is constant for fixed t, c"
      ]
    },
    "validation_logic": {
      "set_theory": "Artifacts A must be a superset of Required R: R \u2286 A",
      "tier_access": "Tier T has access to Target G iff T \u2208 G.supported_tiers"
    }
  },
  "fault_detection": {
    "template_missing": {
      "trigger": "template_ref not found in filesystem",
      "action": "halt_generation",
      "log_level": "critical"
    },
    "artifact_schema_mismatch": {
      "trigger": "required_artifacts do not match expected schema version",
      "action": "warn_and_skip_target",
      "log_level": "error"
    },
    "render_error": {
      "trigger": "jinja2.exceptions.TemplateError",
      "action": "dump_context_and_fail",
      "log_level": "error"
    }
  },
  "detailed_mechanisms": {
    "variable_substitution": {
      "engine": "Jinja2",
      "mode": "strict_undefined",
      "filters": [
        "to_yaml",
        "to_json",
        "b64encode"
      ]
    },
    "post_processing": {
      "markdown_lint": "MD001, MD002 enabled",
      "link_check": "verify_internal_anchors"
    },
    "kpi_validation": {
      "source": "bounded_kpis.json",
      "logic": "For each target environment, verify that projected performance metrics satisfy the bounds defined in bounded_kpis.json.",
      "enforcement": "If kpi_value > max_bound or kpi_value < min_bound: Fail generation for that target."
    }
  }
}