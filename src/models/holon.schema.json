{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://hypersync.io/schemas/core/holon.schema.json",
  "title": "Holon Definition",
  "description": "Defines a self-contained, nested orchestration scope (a 'sub-universe') within the HyperSync manifold.",
  "type": "object",
  "properties": {
    "apiVersion": {
      "type": "string",
      "description": "API version for this Holon definition (for example 'hypersync.io/v1alpha1')."
    },
    "kind": {
      "type": "string",
      "description": "Resource kind. Typically 'HolonDefinition'."
    },
    "holon_id": {
      "type": "string",
      "description": "Logical identifier for this Holon within a topology."
    },
    "name": {
      "type": "string",
      "description": "Human-readable name for this Holon."
    },
    "description": {
      "type": "string",
      "description": "Optional long-form description of the Holon's purpose and behavior."
    },
    "parent_holon_id": {
      "type": "string",
      "description": "ID of the parent Holon. Null or omitted if this is the root."
    },
    "labels": {
      "type": "object",
      "description": "Key-value labels for search, routing, and governance (for example 'env=prod', 'dept=research').",
      "additionalProperties": {
        "type": "string"
      }
    },
    "tags": {
      "type": "array",
      "description": "Free-form tags for classification and UX grouping.",
      "items": {
        "type": "string"
      },
      "uniqueItems": true
    },
    "tenant": {
      "type": "string",
      "description": "Optional tenant or organization identifier."
    },
    "jurisdiction": {
      "type": "string",
      "description": "Optional legal or regulatory jurisdiction (for example 'eu', 'us', 'in')."
    },
    "orchestrator_ref": {
      "type": "string",
      "description": "Identifier of the agent or stack that acts as the orchestrator for this Holon."
    },
    "orchestrator_capabilities": {
      "type": "object",
      "description": "Optional capabilities and limits specific to this Holon's orchestrator.",
      "properties": {
        "can_spawn_child_holons": {
          "type": "boolean"
        },
        "max_child_holons": {
          "type": "integer",
          "minimum": 0
        },
        "can_adjust_acceptance_gates": {
          "type": "boolean"
        },
        "can_adjust_determinism_tier": {
          "type": "boolean"
        }
      }
    },
    "geometry_bounds": {
      "type": "object",
      "description": "The slice of the geometric space assigned to this Holon.",
      "properties": {
        "center": {
          "$ref": "https://hypersync.io/schemas/core/coordinate.schema.json#"
        },
        "center_coordinate": {
          "type": "array",
          "description": "Legacy representation: [r, theta] in the Poincare disk.",
          "items": {
            "type": "number"
          }
        },
        "radius": {
          "type": "number",
          "description": "Approximate radius of the Holon's region in the chosen metric."
        },
        "sector_angle_start": {
          "type": "number",
          "description": "Optional start angle (radians) defining an angular sector."
        },
        "sector_angle_end": {
          "type": "number",
          "description": "Optional end angle (radians) defining an angular sector."
        },
        "metric_policy": {
          "description": "Metric policy used within this Holon's region.",
          "oneOf": [
            {
              "type": "string",
              "description": "Reference to a metric_policy.policy_id."
            },
            {
              "$ref": "https://hypersync.io/schemas/geometry/metric_policy.schema.json#"
            }
          ]
        }
      },
      "required": [
        "radius"
      ]
    },
    "resource_quota": {
      "type": "object",
      "description": "Resource quotas and budgets for this Holon.",
      "properties": {
        "max_agents": {
          "type": "integer",
          "minimum": 0
        },
        "max_compute_units": {
          "type": "integer",
          "minimum": 0
        },
        "max_child_holons": {
          "type": "integer",
          "minimum": 0
        },
        "max_memory_mb": {
          "type": "integer",
          "minimum": 0
        },
        "max_storage_bytes": {
          "type": "integer",
          "minimum": 0
        },
        "max_network_egress_mbps": {
          "type": "number",
          "minimum": 0
        },
        "max_wallclock_seconds": {
          "type": "integer",
          "minimum": 0
        },
        "allowed_models": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "model_budgets": {
          "type": "array",
          "description": "Per-model token and call budgets.",
          "items": {
            "type": "object",
            "properties": {
              "model_id": {
                "type": "string"
              },
              "max_tokens_total": {
                "type": "integer",
                "minimum": 0
              },
              "max_calls": {
                "type": "integer",
                "minimum": 0
              }
            },
            "required": [
              "model_id"
            ]
          }
        }
      },
      "required": [
        "max_agents",
        "max_compute_units"
      ]
    },
    "determinism_config": {
      "type": "object",
      "description": "Determinism tier and seed or clock configuration for this Holon.",
      "properties": {
        "determinism_tier": {
          "type": "string",
          "description": "Determinism tier such as 'D0_BIT_EXACT' or 'D2_STATISTICAL'."
        },
        "root_seed": {
          "type": "string",
          "description": "Seed derived from the parent context for this Holon."
        },
        "seed_strategy": {
          "type": "string",
          "description": "Description or identifier of the seed derivation strategy."
        },
        "merkle_salt": {
          "type": "string",
          "description": "Optional additional salt used in Merkle seed derivations."
        },
        "clock_sync_strategy": {
          "type": "string",
          "description": "How this Holon's logical clock relates to its parent's clock."
        },
        "tick_rate": {
          "type": "object",
          "description": "Logical tick rate configuration.",
          "properties": {
            "mode": {
              "type": "string",
              "enum": [
                "fixed",
                "adaptive"
              ],
              "default": "fixed"
            },
            "base_hz": {
              "type": "number",
              "description": "Base ticks per second for this Holon."
            },
            "max_dilation": {
              "type": "number",
              "description": "Maximum allowed speed-up factor vs parent."
            },
            "min_dilation": {
              "type": "number",
              "description": "Minimum allowed slow-down factor vs parent."
            }
          }
        },
        "allow_nondeterministic_edges": {
          "type": "boolean",
          "description": "If true, this Holon may host D(2) or D(3) processes internally while still providing deterministic summaries upstream."
        }
      },
      "required": [
        "determinism_tier",
        "root_seed"
      ]
    },
    "isolation_level": {
      "type": "string",
      "enum": [
        "permeable",
        "semi_permeable",
        "hermetic"
      ],
      "description": "How much information can flow in and out of this Holon at the boundary."
    },
    "acceptance_gates": {
      "type": "object",
      "description": "Configuration of acceptance gates at this Holon's boundaries.",
      "properties": {
        "ingress": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "gate_id": {
                "type": "string"
              },
              "scope": {
                "type": "string",
                "description": "For example 'holon_boundary' or 'orchestrator_inbox'."
              },
              "strategy": {
                "type": "string",
                "description": "For example 'metropolis_hastings' or 'threshold'."
              },
              "temperature": {
                "type": "number"
              },
              "energy_barrier": {
                "type": "number"
              },
              "distance_decay_lambda": {
                "type": "number"
              },
              "policy_ref": {
                "type": "string"
              },
              "enabled": {
                "type": "boolean"
              }
            },
            "required": [
              "gate_id",
              "strategy"
            ]
          }
        },
        "egress": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "gate_id": {
                "type": "string"
              },
              "scope": {
                "type": "string"
              },
              "strategy": {
                "type": "string"
              },
              "temperature": {
                "type": "number"
              },
              "energy_barrier": {
                "type": "number"
              },
              "policy_ref": {
                "type": "string"
              },
              "enabled": {
                "type": "boolean"
              }
            },
            "required": [
              "gate_id",
              "strategy"
            ]
          }
        },
        "internal": {
          "type": "array",
          "description": "Gates between internal agents or sub-holons.",
          "items": {
            "type": "object",
            "properties": {
              "gate_id": {
                "type": "string"
              },
              "scope": {
                "type": "string"
              },
              "strategy": {
                "type": "string"
              },
              "temperature": {
                "type": "number"
              },
              "energy_barrier": {
                "type": "number"
              },
              "policy_ref": {
                "type": "string"
              },
              "enabled": {
                "type": "boolean"
              }
            },
            "required": [
              "gate_id",
              "strategy"
            ]
          }
        }
      }
    },
    "telemetry": {
      "type": "object",
      "description": "Telemetry and diagnostic export configuration for this Holon.",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "sample_rate": {
          "type": "number",
          "description": "Fraction of events to sample in [0,1]."
        },
        "include_traces": {
          "type": "boolean"
        },
        "diag_plane_endpoint": {
          "type": "string",
          "description": "URI of the diagnostic plane sink."
        },
        "retention": {
          "type": "object",
          "properties": {
            "policy": {
              "type": "string",
              "description": "For example 'keep_last_n' or 'time_window'."
            },
            "days": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "conformance_vector_profile": {
          "type": "string",
          "description": "Identifier for a conformance vector profile applied to this Holon."
        }
      }
    },
    "lifecycle_policy": {
      "type": "object",
      "description": "Lifecycle and auto-scaling policies for the Holon.",
      "properties": {
        "auto_start": {
          "type": "boolean"
        },
        "auto_collapse_on_idle_seconds": {
          "type": "integer",
          "minimum": 0
        },
        "max_duration_seconds": {
          "type": "integer",
          "minimum": 0
        },
        "restart_on_failure": {
          "type": "boolean"
        },
        "max_restarts": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "extensions": {
      "type": "object",
      "description": "Namespace for domain-specific or deployment-specific extensions.",
      "additionalProperties": true
    }
  },
  "required": [
    "holon_id",
    "orchestrator_ref",
    "geometry_bounds",
    "resource_quota",
    "determinism_config"
  ],
  "additionalProperties": true
}