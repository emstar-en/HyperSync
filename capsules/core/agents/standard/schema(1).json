{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "HyperSync Standard Agent API Schema (Enhanced)",
  "type": "object",
  "definitions": {
    "Vector3": {
      "type": "array",
      "items": {
        "type": "number"
      },
      "minItems": 3,
      "maxItems": 3
    },
    "Quaternion": {
      "type": "array",
      "items": {
        "type": "number"
      },
      "minItems": 4,
      "maxItems": 4,
      "description": "Unit quaternion representing orientation."
    },
    "AgentStatus": {
      "type": "string",
      "enum": [
        "IDLE",
        "MOVING",
        "BUSY",
        "ERROR",
        "SUSPENDED"
      ]
    },
    "AgentMode": {
      "type": "string",
      "enum": [
        "AUTONOMOUS",
        "HUMAN_CONTROLLED",
        "MIXED",
        "OBSERVER"
      ]
    },
    "CognitiveProfile": {
      "type": "object",
      "properties": {
        "kind": {
          "type": "string",
          "enum": [
            "HUMAN",
            "LLM",
            "FSM",
            "HYBRID"
          ]
        },
        "capsule_id": {
          "type": "string",
          "description": "Identifier of the cognitive capsule used (if any)."
        },
        "determinism_tier": {
          "type": "string",
          "description": "Determinism tier of the cognitive module."
        },
        "max_tokens_per_tick": {
          "type": "integer",
          "minimum": 0
        },
        "notes": {
          "type": "string"
        }
      },
      "required": [
        "kind"
      ],
      "additionalProperties": false
    },
    "AgentState": {
      "type": "object",
      "properties": {
        "agent_id": {
          "type": "string"
        },
        "position": {
          "$ref": "#/definitions/Vector3"
        },
        "velocity": {
          "$ref": "#/definitions/Vector3"
        },
        "heading": {
          "$ref": "#/definitions/Quaternion"
        },
        "energy": {
          "type": "number"
        },
        "status": {
          "$ref": "#/definitions/AgentStatus"
        },
        "mode": {
          "$ref": "#/definitions/AgentMode"
        },
        "cognitive_profile": {
          "$ref": "#/definitions/CognitiveProfile"
        },
        "memory_digest": {
          "type": "string",
          "description": "Opaque digest of local memory state for determinism/debugging."
        },
        "tick_counter": {
          "type": "integer",
          "minimum": 0
        },
        "last_error": {
          "type": [
            "null",
            "string"
          ]
        }
      },
      "required": [
        "position",
        "status",
        "mode"
      ],
      "additionalProperties": true
    },
    "Observation": {
      "type": "object",
      "properties": {
        "local_agents": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "agent_id": {
                "type": "string"
              },
              "position": {
                "$ref": "#/definitions/Vector3"
              },
              "status": {
                "$ref": "#/definitions/AgentStatus"
              }
            },
            "required": [
              "agent_id"
            ],
            "additionalProperties": true
          }
        },
        "local_geometry": {
          "type": "object",
          "description": "Geometry-defined summary of nearby space (obstacles, fences, gradients)."
        },
        "messages": {
          "type": "array",
          "items": {
            "type": "object"
          }
        }
      },
      "additionalProperties": true
    },
    "ActionType": {
      "type": "string",
      "enum": [
        "MOVE",
        "WAIT",
        "SIGNAL",
        "INTERACT",
        "OBSERVE_ONLY",
        "EMIT_EVENT"
      ]
    },
    "ActionRequest": {
      "type": "object",
      "properties": {
        "type": {
          "$ref": "#/definitions/ActionType"
        },
        "parameters": {
          "type": "object"
        },
        "nonce": {
          "type": "integer"
        },
        "constraints": {
          "type": "object",
          "description": "Optional constraints supplied by environment (speed limits, fences, etc.)."
        },
        "safety_context": {
          "type": "object",
          "description": "Context used to explain or audit this action (e.g., explanation IDs)."
        }
      },
      "required": [
        "type",
        "nonce"
      ],
      "additionalProperties": true
    },
    "AgentCommandType": {
      "type": "string",
      "enum": [
        "TICK",
        "INTROSPECT",
        "SHUTDOWN",
        "RESET"
      ]
    },
    "AgentCommand": {
      "type": "object",
      "properties": {
        "command_type": {
          "$ref": "#/definitions/AgentCommandType"
        },
        "parameters": {
          "type": "object",
          "description": "Command-specific parameters."
        }
      },
      "required": [
        "command_type"
      ],
      "additionalProperties": true
    },
    "TickRequest": {
      "type": "object",
      "properties": {
        "command": {
          "$ref": "#/definitions/AgentCommand"
        },
        "state": {
          "$ref": "#/definitions/AgentState"
        },
        "observation": {
          "$ref": "#/definitions/Observation"
        }
      },
      "required": [
        "command",
        "state"
      ],
      "additionalProperties": false
    },
    "TickResult": {
      "type": "object",
      "properties": {
        "next_state": {
          "$ref": "#/definitions/AgentState"
        },
        "action": {
          "$ref": "#/definitions/ActionRequest"
        },
        "telemetry": {
          "type": "object",
          "description": "Optional per-tick telemetry (counters, debug info)."
        }
      },
      "required": [
        "next_state"
      ],
      "additionalProperties": false
    }
  },
  "properties": {
    "request": {
      "$ref": "#/definitions/TickRequest"
    },
    "response": {
      "$ref": "#/definitions/TickResult"
    }
  },
  "additionalProperties": false
}