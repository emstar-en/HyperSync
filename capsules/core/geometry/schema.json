{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "HyperSync Core Geometry Capsule API Schema (Enhanced)",
  "type": "object",
  "definitions": {
    "SpaceId": {
      "type": "string",
      "description": "Identifier for a geometric space or manifold."
    },
    "Point": {
      "type": "object",
      "properties": {
        "coords": {
          "type": "array",
          "items": {
            "type": "number"
          },
          "description": "Coordinate vector in the local chart."
        },
        "chart_id": {
          "type": "string",
          "description": "Optional chart identifier within the manifold."
        }
      },
      "required": ["coords"],
      "additionalProperties": false
    },
    "RegionRef": {
      "type": "object",
      "properties": {
        "region_id": {
          "type": "string",
          "description": "Identifier for a region of interest or safety fence."
        }
      },
      "required": ["region_id"],
      "additionalProperties": false
    },
    "DeterminismProfile": {
      "type": "object",
      "properties": {
        "tier": {
          "type": "string",
          "description": "Requested determinism tier (typically D0_bit_exact for core geometry)."
        },
        "tolerance": {
          "type": "number",
          "description": "Optional numerical tolerance for approximate operations."
        }
      },
      "required": ["tier"],
      "additionalProperties": false
    },
    "GeometryOperation": {
      "type": "string",
      "enum": [
        "GetSpaceDescriptor",
        "ListSpaces",
        "Distance",
        "Norm",
        "Geodesic",
        "ShortestPath",
        "Project",
        "Embed",
        "IsInsideFence",
        "ClampToFence"
      ]
    },
    "GeometryRequest": {
      "type": "object",
      "properties": {
        "operation": {
          "$ref": "#/definitions/GeometryOperation"
        },
        "space_id": {
          "$ref": "#/definitions/SpaceId"
        },
        "payload": {
          "type": "object",
          "description": "Operation-specific payload, see per-operation documentation."
        },
        "determinism": {
          "$ref": "#/definitions/DeterminismProfile"
        },
        "trace_id": {
          "type": "string",
          "description": "Optional trace identifier for receipts and telemetry correlation."
        }
      },
      "required": ["operation"],
      "additionalProperties": false
    },
    "GeometryResponse": {
      "type": "object",
      "properties": {
        "ok": {
          "type": "boolean"
        },
        "result": {
          "type": "object",
          "description": "Operation-specific result object."
        },
        "error": {
          "type": ["null", "object"],
          "description": "Error object if ok = false."
        },
        "meta": {
          "type": "object",
          "description": "Metadata including determinism tier, tolerance, and capsule identity."
        }
      },
      "required": ["ok"],
      "additionalProperties": false
    }
  },
  "properties": {
    "request": {
      "$ref": "#/definitions/GeometryRequest"
    },
    "response": {
      "$ref": "#/definitions/GeometryResponse"
    }
  },
  "additionalProperties": false
}
